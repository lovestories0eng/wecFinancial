!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}((function(t){"use strict";function e(t){"object"==typeof t&&(this.minChars=t.minChars,this.style=t.style,this.showToken=t.showToken,this.delay=t.delay,this.wordsOnly=t.wordsOnly),null==this.style&&(this.style="matchhighlight"),null==this.minChars&&(this.minChars=2),null==this.delay&&(this.delay=100),null==this.wordsOnly&&(this.wordsOnly=!1),this.overlay=this.timeout=null}function i(t){var e=t.state.matchHighlighter;clearTimeout(e.timeout),e.timeout=setTimeout((function(){n(t)}),e.delay)}function n(t){t.operation((function(){var e=t.state.matchHighlighter;if(e.overlay&&(t.removeOverlay(e.overlay),e.overlay=null),t.somethingSelected()||!e.showToken){var i=t.getCursor("from"),n=t.getCursor("to");if(i.line==n.line&&(!e.wordsOnly||function(t,e,i){if(null!==t.getRange(e,i).match(/^\w+$/)){if(e.ch>0){var n={line:e.line,ch:e.ch-1};if(null===t.getRange(n,e).match(/\W/))return!1}return!(i.ch<t.getLine(e.line).length&&(n={line:i.line,ch:i.ch+1},null===t.getRange(i,n).match(/\W/)))}return!1}(t,i,n))){var o=t.getRange(i,n).replace(/^\s+|\s+$/g,"");o.length>=e.minChars&&t.addOverlay(e.overlay=r(o,!1,e.style))}}else{for(var l=!0===e.showToken?/[\w$]/:e.showToken,h=t.getCursor(),s=t.getLine(h.line),a=h.ch,c=a;a&&l.test(s.charAt(a-1));)--a;for(;c<s.length&&l.test(s.charAt(c));)++c;a<c&&t.addOverlay(e.overlay=r(s.slice(a,c),l,e.style))}}))}function r(t,e,i){return{token:function(n){if(n.match(t)&&(!e||function(t,e){return!(t.start&&e.test(t.string.charAt(t.start-1))||t.pos!=t.string.length&&e.test(t.string.charAt(t.pos)))}(n,e)))return i;n.next(),n.skipTo(t.charAt(0))||n.skipToEnd()}}}t.defineOption("highlightSelectionMatches",!1,(function(r,o,l){if(l&&l!=t.Init){var h=r.state.matchHighlighter.overlay;h&&r.removeOverlay(h),clearTimeout(r.state.matchHighlighter.timeout),r.state.matchHighlighter=null,r.off("cursorActivity",i)}o&&(r.state.matchHighlighter=new e(o),n(r),r.on("cursorActivity",i))}))}));