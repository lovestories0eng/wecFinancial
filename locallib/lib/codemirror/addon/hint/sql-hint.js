!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}((function(t){"use strict";var r,n,e,o=t.Pos;function i(t){return"string"==typeof t?t:t.text}function s(t,r){if(!t.slice)return t[r];for(var n=t.length-1;n>=0;n--)if(i(t[n])==r)return t[n]}function a(t){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r}function u(t,r){var n=t.length,e=i(r).substr(0,n);return t.toUpperCase()===e.toUpperCase()}function f(t,r,n,e){for(var o in n)n.hasOwnProperty(o)&&(Array.isArray(n)&&(o=n[o]),u(r,o)&&t.push(e(o)))}function c(t){for(var r=i(t).split("."),n=0;n<r.length;n++)r[n]="`"+r[n]+"`";var e=r.join(".");return"string"==typeof t?e:((t=a(t)).text=e,t)}function l(t,r){if(t)for(var n=/[,;]/g,e=t.split(" "),o=0;o<e.length;o++)r(e[o]?e[o].replace(n,""):"")}function p(t){return t.line+t.ch/Math.pow(10,6)}function g(t){return o(Math.floor(t),+t.toString().split(".").pop())}t.registerHelper("hint","sql",(function(i,u){r=u&&u.tables||{};var h=u&&u.defaultTable;n=h&&s(r,h)||[],e=e||function(r){var n=r.doc.modeOption;return"sql"===n&&(n="text/x-sql"),t.resolveMode(n).keywords}(i);var d,v,y,A=i.getCursor(),m=[],x=i.getTokenAt(A);return x.end>A.ch&&(x.end=A.ch,x.string=x.string.slice(0,A.ch-x.start)),x.string.match(/^[.`\w@]\w*$/)?(y=x.string,d=x.start,v=x.end):(d=v=A.ch,y=""),"."==y.charAt(0)||"`"==y.charAt(0)?d=function(t,e,i,u){for(var h,d=!1,v=[],y=e.start,A=!0;A;)A="."==e.string.charAt(0),d=d||"`"==e.string.charAt(0),y=e.start,v.unshift(("."==(h=e.string).charAt(0)&&(h=h.substr(1)),h.replace(/`/g,""))),"."==(e=u.getTokenAt(o(t.line,e.start))).string&&(A=!0,e=u.getTokenAt(o(t.line,e.start)));var m=v.join(".");f(i,m,r,(function(t){return d?c(t):t})),f(i,m,n,(function(t){return d?c(t):t})),m=v.pop();var x=v.join(".");s(r,x)||(x=function(t,n){for(var e=n.doc,i=e.getValue(),a=t.toUpperCase(),u="",f="",c=[],h={start:o(0,0),end:o(n.lastLine(),n.getLineHandle(n.lastLine()).length)},d=i.indexOf(";");-1!=d;)c.push(e.posFromIndex(d)),d=i.indexOf(";",d+1);c.unshift(o(0,0)),c.push(o(n.lastLine(),n.getLineHandle(n.lastLine()).text.length));for(var v=0,y=p(n.getCursor()),A=0;A<c.length;A++){var m=p(c[A]);if(y>v&&y<=m){h={start:g(v),end:g(m)};break}v=m}var x=e.getRange(h.start,h.end,!1);for(A=0;A<x.length&&(l(x[A],(function(t){var n=t.toUpperCase();n===a&&s(r,u)&&(f=u),"AS"!==n&&(u=t)})),!f);A++);return f}(x,u));var b=s(r,x);return b&&Array.isArray(r)&&b.columns&&(b=b.columns),b&&f(i,m,b,(function(t){return"string"==typeof t?t=x+"."+t:(t=a(t)).text=x+"."+t.text,d?c(t):t})),y}(A,x,m,i):(f(m,y,r,(function(t){return t})),f(m,y,n,(function(t){return t})),f(m,y,e,(function(t){return t.toUpperCase()}))),{list:m,from:o(A.line,d),to:o(A.line,v)}}))}));